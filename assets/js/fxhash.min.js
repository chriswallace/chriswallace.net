"use strict";(()=>{var t="123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ";function n(n,e){return n.slice(e).match(new RegExp(".{"+(n.length-e>>2)+"}","g")).map((function(n){return function(n){return[...n].reduce((function(n,e){return 58*n+t.indexOf(e)|0}),0)}(n)}))}function e(n){return Array(n).fill(0).map((function(n){return t[58*Math.random()|0]})).join("")}function r(t,e){return function(t){let n=0|t[0],e=0|t[1],r=0|t[2],a=0|t[3];return function(){n|=0,e|=0,r|=0,a|=0;const t=(n+e|0)+a|0;return a=a+1|0,n=e^e>>>9,e=r+(r<<3)|0,r=r<<21|r>>>11,r=r+t|0,(t>>>0)/4294967296}}(n(t,e))}function a(t){let n=t.replace("#","");return 6===n.length&&(n=`${n}ff`),3===n.length&&(n=`${n[0]}${n[0]}${n[1]}${n[1]}${n[2]}${n[2]}ff`),n}var i=function(t){let n="";for(let e=0;e<t.length;e++)n+=t.charCodeAt(e).toString(16).padStart(4,"0");return n},s=BigInt("-9223372036854775808"),o=BigInt("9223372036854775807"),u={number:{serialize:t=>{const n=new DataView(new ArrayBuffer(8));return n.setFloat64(0,t),n.getBigUint64(0).toString(16).padStart(16,"0")},deserialize:t=>{const n=new DataView(new ArrayBuffer(8));for(let e=0;e<8;e++)n.setUint8(e,parseInt(t.substring(2*e,2*e+2),16));return n.getFloat64(0)},bytesLength:()=>8,constrain:(t,n)=>{let e=Number.MIN_SAFE_INTEGER;void 0!==n.options?.min&&(e=Number(n.options.min));let r=Number.MAX_SAFE_INTEGER;void 0!==n.options?.max&&(r=Number(n.options.max)),r=Math.min(r,Number.MAX_SAFE_INTEGER),e=Math.max(e,Number.MIN_SAFE_INTEGER);const a=Math.min(Math.max(t,e),r);if(n?.options?.step){const t=1/n?.options?.step;return Math.round(a*t)/t}return a},random:t=>{let n=Number.MIN_SAFE_INTEGER;void 0!==t.options?.min&&(n=Number(t.options.min));let e=Number.MAX_SAFE_INTEGER;void 0!==t.options?.max&&(e=Number(t.options.max)),e=Math.min(e,Number.MAX_SAFE_INTEGER),n=Math.max(n,Number.MIN_SAFE_INTEGER);const r=Math.random()*(e-n)+n;if(t?.options?.step){const n=1/t?.options?.step;return Math.round(r*n)/n}return r}},bigint:{serialize:t=>{const n=new DataView(new ArrayBuffer(8));return n.setBigInt64(0,BigInt(t)),n.getBigUint64(0).toString(16).padStart(16,"0")},deserialize:t=>{const n=new DataView(new ArrayBuffer(8));for(let e=0;e<8;e++)n.setUint8(e,parseInt(t.substring(2*e,2*e+2),16));return n.getBigInt64(0)},bytesLength:()=>8,random:t=>{let n=s,e=o;void 0!==t.options?.min&&(n=BigInt(t.options.min)),void 0!==t.options?.max&&(e=BigInt(t.options.max));const r=e-n,a=r.toString(2).length;let i;do{i=BigInt("0b"+Array.from(crypto.getRandomValues(new Uint8Array(Math.ceil(a/8)))).map((t=>t.toString(2).padStart(8,"0"))).join(""))}while(i>r);return i+n}},boolean:{serialize:t=>"boolean"==typeof t?t?"01":"00":"string"==typeof t&&"true"===t?"01":"00",deserialize:t=>"00"!==t,bytesLength:()=>1,random:()=>Math.random()<.5},color:{serialize:t=>a(t),deserialize:t=>t,bytesLength:()=>4,transform:t=>{const n=a(t),e=parseInt(n.slice(0,2),16),r=parseInt(n.slice(2,4),16),i=parseInt(n.slice(4,6),16),s=parseInt(n.slice(6,8),16);return{hex:{rgb:"#"+t.slice(0,6),rgba:"#"+t},obj:{rgb:{r:e,g:r,b:i},rgba:{r:e,g:r,b:i,a:s}},arr:{rgb:[e,r,i],rgba:[e,r,i,s]}}},constrain:t=>t.replace("#","").slice(0,8).padEnd(8,"f"),random:()=>`${[...Array(8)].map((()=>Math.floor(16*Math.random()).toString(16))).join("")}`},string:{serialize:(t,n)=>{if(!n.version){let n=i(t.substring(0,64));return n=n.padEnd(256,"0"),n}let e=64;void 0!==n.options?.maxLength&&(e=Number(n.options.maxLength));let r=i(t.substring(0,e));return r=r.padEnd(4*e,"0"),r},deserialize:t=>function(t){const n=t.match(/.{1,4}/g)||[];let e="";for(let t=0;t<n.length;t++){const r=parseInt(n[t],16);if(0===r)break;e+=String.fromCharCode(r)}return e}(t),bytesLength:t=>t.version&&void 0!==t.options?.maxLength?2*Number(t.options.maxLength):128,random:t=>{let n=0;void 0!==t.options?.minLength&&(n=t.options.minLength);let e=64;void 0!==t.options?.maxLength&&(e=t.options.maxLength);const r=Math.round(Math.random()*(e-n)+n);return[...Array(r)].map((t=>(~~(36*Math.random())).toString(36))).join("")},constrain:(t,n)=>{let e=0;void 0!==n.options?.minLength&&(e=n.options.minLength);let r=64;void 0!==n.options?.maxLength&&(r=n.options.maxLength);const a=t.slice(0,r);return a.length<e?a.padEnd(e):a}},bytes:{serialize:(t,n)=>Array.from(t).map((t=>t.toString(16).padStart(2,"0"))).join(""),deserialize:(t,n)=>{const e=t.length/2,r=new Uint8Array(e);let a;for(let n=0;n<e;n++)a=2*n,r[n]=parseInt(`${t[a]}${t[a+1]}`,16);return r},bytesLength:t=>t.options.length,random:t=>{const n=t.options?.length||0,e=new Uint8Array(n);for(let t=0;t<n;t++)e[t]=255*Math.random()|0;return e}},select:{serialize:(t,n)=>Math.min(255,n.options?.options?.indexOf(t)||0).toString(16).padStart(2,"0"),deserialize:(t,n)=>{const e=parseInt(t,16);return n.options?.options?.[e]||n.options?.options?.[0]||""},bytesLength:()=>1,constrain:(t,n)=>n.options.options.includes(t)?t:n.options.options[0],random:t=>{const n=Math.round(Math.random()*(t.options.options.length-1)+0);return t?.options?.options[n]}}};var p=(t,n,e)=>{const r={};for(const a of n){const n=u[a.type],i=t[a.id],s=n[e];r[a.id]=s?.(i,a)||i}return r};window.$fx=function(t){const{parent:n}=t,a=new URLSearchParams(t.location.search),i=a.get("fxhash")||"oo"+e(49);let s=r(i,2);const o=a.get("fxminter")||"tz1"+e(33);let m=r(o,3);const f="1"===a.get("preview"),h=t.location.hash,c=h?.replace("#0x",""),d={_version:"3.3.0",_processors:u,_params:void 0,_features:void 0,_paramValues:{},_listeners:{},_receiveUpdateParams:async function(t,n){const e=await this.propagateEvent("params:update",t);e.forEach((([e,r])=>{("boolean"!=typeof e||e)&&(this._updateParams(t),n?.()),r?.(e,t)})),0===e.length&&(this._updateParams(t),n?.())},_updateParams:function(t){const n=p({...this._rawValues,...t},this._params,"constrain");Object.keys(n).forEach((t=>{this._rawValues[t]=n[t]})),this._paramValues=p(this._rawValues,this._params,"transform"),this._updateInputBytes()},_updateInputBytes:function(){const t=function(t,n){let e="";if(!n)return e;for(const r of n){const{id:n,type:a}=r,i=u[a],s=t[n],o=void 0!==s?s:void 0!==r.default?r.default:i.random(r);e+=i.serialize(o,r)}return e}(this._rawValues,this._params);this.inputBytes=t},_emitParams:function(t){const e=Object.keys(t).reduce(((n,e)=>(n[e]=((t,n,e,r)=>{const a=e.find((n=>n.id===t)),i=u[a.type][r];return i?.(n,a)||n})(e,t[e],this._params,"constrain"),n)),{});this._receiveUpdateParams(e,(()=>{n.postMessage({id:"fxhash_emit:params:update",data:{params:e}},"*")}))},hash:i,rand:s,minter:o,randminter:m,iteration:Number(a.get("fxiteration"))||1,context:a.get("fxcontext")||"standalone",preview:function n(){t.dispatchEvent(new Event("fxhash-preview")),setTimeout((()=>n()),500)},isPreview:f,params:function(t){this._params=t.map((t=>({...t,version:this._version}))),this._rawValues=function(t,n,e){const r={};for(const a of n){const n=u[a.type],i=e.withTransform&&n[e.transformType||"transform"];if(!t){let t;t=void 0===a.default?n.random(a):a.default,r[a.id]=i?i(t,a):t;continue}const s=n.bytesLength(a),o=t.substring(0,2*s);t=t.substring(2*s);const p=n.deserialize(o,a);r[a.id]=i?i(p,a):p}return r}(c,this._params,{withTransform:!0,transformType:"constrain"}),this._paramValues=p(this._rawValues,this._params,"transform"),this._updateInputBytes()},features:function(t){this._features=t},getFeature:function(t){return this._features[t]},getFeatures:function(){return this._features},getParam:function(t){return this._paramValues[t]},getParams:function(){return this._paramValues},getRawParam:function(t){return this._rawValues[t]},getRawParams:function(){return this._rawValues},getRandomParam:function(t){const n=this._params.find((n=>n.id===t));return u[n.type].random(n)},getDefinitions:function(){return this._params},stringifyParams:function(t){return JSON.stringify(t||this._rawValues,((t,n)=>"bigint"==typeof n?n.toString():n),2)},on:function(t,n,e){return this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push([n,e]),()=>{const e=this._listeners[t].findIndex((([t])=>t===n));e>-1&&this._listeners[t].splice(e,1)}},propagateEvent:async function(t,n){const e=[];if(this._listeners?.[t])for(const[r,a]of this._listeners[t]){const t=r(n);e.push([t instanceof Promise?await t:t,a])}return e},emit:function(t,n){if("params:update"===t)this._emitParams(n);else console.log("$fx.emit called with unknown id:",t)}},l=()=>{s=r(i,2),d.rand=s,s.reset=l};s.reset=l;const g=()=>{m=r(o,3),d.randminter=m,m.reset=g};return m.reset=g,t.addEventListener("message",(e=>{if("fxhash_getInfo"===e.data&&n.postMessage({id:"fxhash_getInfo",data:{version:t.$fx._version,hash:t.$fx.hash,iteration:t.$fx.iteration,features:t.$fx.getFeatures(),params:{definitions:t.$fx.getDefinitions(),values:t.$fx.getRawParams()},minter:t.$fx.minter}},"*"),"fxhash_params:update"===e.data?.id){const{params:n}=e.data.data;n&&t.$fx._receiveUpdateParams(n)}})),d}(window)})();