document.addEventListener("DOMContentLoaded",(()=>{let e,t=null,n=null;const o=document.getElementById("art-collection");let r=o.querySelectorAll("img");const l=document.createElement("div");l.style.position="absolute",l.style.backgroundColor="black",l.style.color="white",l.style.padding="5px 10px",l.style.borderRadius="5px",l.style.display="none",l.style.zIndex="9999",document.body.appendChild(l);var i=document.createElement("canvas");function c(){try{return!(!window.WebGLRenderingContext||!i.getContext("webgl")&&!i.getContext("experimental-webgl"))}catch(e){return!1}}function d(){return/Mobi|Android/i.test(navigator.userAgent)}function s(e,t,n){fetch(`/collection/chunk${e}.json`).then((e=>e.json())).then((e=>{!function(e,t){t.forEach(((t,n)=>{const o=e[n];if(o){const e=document.createElement("div");e.classList.add("artwork-metadata","hidden");const n=document.createElement("h3");n.textContent=o.name||"Artwork",e.appendChild(n);const r=document.createElement("p");r.textContent=`Artist: ${o.artist||"Unknown"}`,e.appendChild(r);const l=document.createElement("p");l.textContent=`Description: ${o.description||"No description available."}`,e.appendChild(l),t.parentNode.appendChild(e)}}))}(e,t),n&&n()})).catch((e=>console.error("Error loading JSON:",e)))}const a=()=>{if(n&&clearTimeout(n),r=o.querySelectorAll("img"),null===t)return;t>=r.length-1&&y();const e=r[t],l=r[t+1];let i;if(i=e.getAttribute("data-iframe-src")?12e3:8e3,l&&!l.getAttribute("data-iframe-src")){const e=new Image,t=l.getAttribute("src");e.src=t}n=setTimeout((()=>{m(1),a()}),i)},u=document.getElementById("autoPlayCollection");u&&u.addEventListener("click",(()=>{h(document.querySelectorAll("img")[0],0,!0),a(),document.getElementById("playButton").click()})),r.forEach(((e,t)=>f(e,t))),document.addEventListener("keydown",(function(e){"ArrowLeft"===e.key?m(-1):"ArrowRight"===e.key&&m(1)}));const m=e=>{r=o.querySelectorAll("img");const n=r.length;if(null===t||0===n)return;let l=t+e;l<0||l>=n||(r[t].removeAttribute("data-is-current"),h(r[l],l))};function f(e,t){if("true"===e.getAttribute("data-processed"))return;imgObserver.observe(e),e.addEventListener("mouseover",(function(e){const t=this.getAttribute("alt");t&&(l.textContent=t,l.style.display="block")})),e.addEventListener("mousemove",(function(e){const t=l.offsetWidth,n=window.innerWidth;e.pageX+t+20>n?l.style.left=e.pageX-t-10+"px":l.style.left=e.pageX+10+"px",l.style.top=e.pageY+10+"px"})),e.addEventListener("mouseout",(function(){l.style.display="none"}));const n=document.createElement("div");n.classList.add("image-wrapper"),e.parentNode.insertBefore(n,e),n.appendChild(e);const o=document.createElement("div");if(o.classList.add("maximize-icon"),d()&&e.alt.trim().length){const t=document.createElement("caption");t.innerHTML=e.alt,n.appendChild(t)}!d()&&c()&&(n.appendChild(o),o.addEventListener("click",(()=>h(e,t)))),e.setAttribute("data-processed","true")}const h=(o,r,l=!1)=>{e=document.getElementById("fullscreen-viewer"),e||(e=document.createElement("div"),e.id="fullscreen-viewer",document.body.appendChild(e)),e.classList.add("fullscreen-viewer","fade-out"),setTimeout((()=>{const i=document.createElement("div");i.className="loader";const c=document.createElement("img"),d=o.getAttribute("src"),s=o.getAttribute("data-iframe-src"),u=o.getAttribute("data-iframe-size"),m=o.parentNode.querySelector(".artwork-metadata"),f=m?m.cloneNode(!0):null;if(f&&f.classList.remove("hidden"),document.querySelectorAll("[data-is-current='true']").forEach((e=>e.setAttribute("data-is-current","false"))),o.setAttribute("data-is-current","true"),c.onload=()=>{i.remove(),s&&f&&f.appendChild(function(e,t,o){const r=document.createElement("button");return r.textContent="View Live",r.className="live-code-btn",r.addEventListener("click",(()=>{if(e){n&&(clearTimeout(n),n=null);const r=t.offsetWidth,l=t.offsetHeight,i=document.createElement("iframe");i.setAttribute("src",e),"fullscreen"===o?(i.setAttribute("width",window.innerWidth),i.setAttribute("height",window.innerHeight)):(i.setAttribute("width",r),i.setAttribute("height",l));const c=document.querySelector(".fullscreen-artwork");c.innerHTML="",c.appendChild(i)}})),r}(s,c,u))},e.classList.remove("hidden"),t=r,"fullscreen"===u&&s){const t=document.createElement("div"),n=document.createElement("iframe");return n.setAttribute("src",s),n.setAttribute("style","position: absolute; left: 0; top: 0; right: 0; bottom: 0; width: 100vw; height: 100vh;"),e.innerHTML="",e.appendChild(t),t.appendChild(n),e.className="",void(e.requestFullscreen&&e.requestFullscreen())}let h;h=d.endsWith(".gif")||d.includes(".gif?")?d.replace(/w-\d+,?/,""):d.replace(/w-\d+/,"w-"+2*window.innerWidth).replace(/q-\d+/,"q-90"),h=h.replace(/,bl-\d+/,""),c.src=h,c.setAttribute("src",h);const p=document.createElement("div");p.classList.add("fullscreen-artwork"),e.innerHTML="",e.appendChild(i),e.appendChild(p),p.appendChild(c);const g=document.createElement("div");g.className="fullscreen-content",f&&g.appendChild(f),e.appendChild(g),e.classList.remove("fade-out"),e.requestFullscreen&&e.requestFullscreen(),l&&a()}),750)};if(!d()&&c()){let A=document.getElementsByClassName("live-code");Array.from(A).forEach((e=>{let t=e.getAttribute("data-src");t&&(e.src=t)}))}const p=()=>{document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||(e.className="hidden",n&&(clearTimeout(n),n=null))};document.addEventListener("fullscreenchange",p),document.addEventListener("webkitfullscreenchange",p),document.addEventListener("mozfullscreenchange",p),document.addEventListener("MSFullscreenChange",p);let g=0;const w=e=>{e.forEach((e=>v.observe(e)))};const b=document.querySelectorAll(".fade-in-element,.art-collection .media-wrapper,.art-collection h3,.art-collection h4");!function(e,t=66){if(!e||"function"!=typeof e)return;let n;window.addEventListener("scroll",(function(o){window.clearTimeout(n),n=setTimeout(e,t)}),!1)}((function(){g=0}));const v=new IntersectionObserver((e=>{e.forEach((e=>{if(e.isIntersecting){const t=50*g;((e,t)=>{setTimeout((()=>{e.classList.add("visible")}),t)})(e.target,t),v.unobserve(e.target),g++}}))}));function E(e){let t=1e4*Math.sin(e++);return t-Math.floor(t)}if(w(b),window.pageSettings){let L=!1,C=window.pageSettings.htmlParts;function y(){if(L)return;if(0===Object.keys(C).length)return;const e=Math.floor((new Date).getTime()/36e5),t=Object.keys(C);!function(e,t){let n,o=e.length;for(;0!==o;)n=Math.floor(E(t)*o),o--,[e[o],e[n]]=[e[n],e[o]]}(t,e);const n=t[0],o=C[n];delete C[n],L=!0,fetch(o).then((e=>e.text())).then((e=>{const t=document.getElementById("art-collection");t.insertAdjacentHTML("beforeend",e);const o=t.querySelectorAll("img:not(.loaded),video:not(.loaded)");o.forEach(((e,t)=>f(e,t)));const r=t.querySelectorAll(".fade-in-element:not(.visible),.art-collection .media-wrapper:not(.visible),.art-collection h3:not(.visible),.art-collection h4:not(.visible)");w(r),s(Number(n),o),L=!1})).catch((e=>{console.error("Fetch failed:",e),L=!1}))}y();let k=0;window.addEventListener("scroll",(()=>{const e=Date.now();e-k>200&&(window.innerHeight+window.scrollY>=document.body.offsetHeight-500&&y(),k=e)}))}}));