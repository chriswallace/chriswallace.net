document.addEventListener("DOMContentLoaded",(()=>{let e,t=null,n=null;const r=document.getElementById("art-collection");let o=r.querySelectorAll("img");const l=document.createElement("div");l.style.position="absolute",l.style.backgroundColor="black",l.style.color="white",l.style.padding="5px 10px",l.style.borderRadius="5px",l.style.display="none",l.style.zIndex="9999",document.body.appendChild(l);var c=document.createElement("canvas");function i(){try{return!(!window.WebGLRenderingContext||!c.getContext("webgl")&&!c.getContext("experimental-webgl"))}catch(e){return!1}}function d(){return/Mobi|Android/i.test(navigator.userAgent)}function s(e,t,n){fetch(`/collection/chunk${e}.json`).then((e=>e.json())).then((e=>{!function(e,t){t.forEach(((t,n)=>{const r=e[n];if(r){const e=document.createElement("div");e.classList.add("artwork-metadata","hidden");const n=document.createElement("h3");n.textContent=r.name||"Artwork",e.appendChild(n);const o=document.createElement("p");o.textContent=`Artist: ${r.artist||"Unknown"}`,e.appendChild(o);const l=document.createElement("p");l.textContent=`Description: ${r.description||"No description available."}`,e.appendChild(l),t.parentNode.appendChild(e)}}))}(e,t),n&&n()})).catch((e=>console.error("Error loading JSON:",e)))}const a=()=>{if(n&&clearTimeout(n),o=r.querySelectorAll("img"),null===t)return;t>=o.length-1&&E();const e=o[t],l=o[t+1];let c;if(c=e.getAttribute("data-iframe-src")?12e3:8e3,l&&!l.getAttribute("data-iframe-src")){const e=new Image,t=l.getAttribute("src");e.src=t}n=setTimeout((()=>{m(1),a()}),c)},u=document.getElementById("autoPlayCollection");u&&u.addEventListener("click",(()=>{h(document.querySelectorAll("img")[0],0,!0),a(),document.getElementById("playButton").click()})),o.forEach(((e,t)=>setupImages(e,t))),document.addEventListener("keydown",(function(e){"ArrowLeft"===e.key?m(-1):"ArrowRight"===e.key&&m(1)}));const m=e=>{o=r.querySelectorAll("img");const n=o.length;if(null===t||0===n)return;let l=t+e;l<0||l>=n||(o[t].removeAttribute("data-is-current"),h(o[l],l))},h=(r,o,l=!1)=>{e=document.getElementById("fullscreen-viewer"),e||(e=document.createElement("div"),e.id="fullscreen-viewer",document.body.appendChild(e)),e.classList.add("fullscreen-viewer","fade-out"),setTimeout((()=>{const c=document.createElement("div");c.className="loader";const i=document.createElement("img"),d=r.getAttribute("src"),s=r.getAttribute("data-iframe-src"),u=r.getAttribute("data-iframe-size"),m=r.parentNode.querySelector(".artwork-metadata"),h=m?m.cloneNode(!0):null;if(h&&h.classList.remove("hidden"),document.querySelectorAll("[data-is-current='true']").forEach((e=>e.setAttribute("data-is-current","false"))),r.setAttribute("data-is-current","true"),i.onload=()=>{c.remove(),s&&h&&h.appendChild(function(e,t,r){const o=document.createElement("button");return o.textContent="View Live",o.className="live-code-btn",o.addEventListener("click",(()=>{if(e){n&&(clearTimeout(n),n=null);const o=t.offsetWidth,l=t.offsetHeight,c=document.createElement("iframe");c.setAttribute("src",e),"fullscreen"===r?(c.setAttribute("width",window.innerWidth),c.setAttribute("height",window.innerHeight)):(c.setAttribute("width",o),c.setAttribute("height",l));const i=document.querySelector(".fullscreen-artwork");i.innerHTML="",i.appendChild(c)}})),o}(s,i,u))},e.classList.remove("hidden"),t=o,"fullscreen"===u&&s){const t=document.createElement("div"),n=document.createElement("iframe");return n.setAttribute("src",s),n.setAttribute("style","position: absolute; left: 0; top: 0; right: 0; bottom: 0; width: 100vw; height: 100vh;"),e.innerHTML="",e.appendChild(t),t.appendChild(n),e.className="",void(e.requestFullscreen&&e.requestFullscreen())}let f;f=d.endsWith(".gif")||d.includes(".gif?")?d.replace(/w-\d+,?/,""):d.replace(/w-\d+/,"w-"+2*window.innerWidth).replace(/q-\d+/,"q-90"),f=f.replace(/,bl-\d+/,""),i.src=f,i.setAttribute("src",f);const p=document.createElement("div");p.classList.add("fullscreen-artwork"),e.innerHTML="",e.appendChild(c),e.appendChild(p),p.appendChild(i);const g=document.createElement("div");g.className="fullscreen-content",h&&g.appendChild(h),e.appendChild(g),e.classList.remove("fade-out"),e.requestFullscreen&&e.requestFullscreen(),l&&a()}),750)};if(!d()&&i()){let y=document.getElementsByClassName("live-code");Array.from(y).forEach((e=>{let t=e.getAttribute("data-src");t&&(e.src=t)}))}const f=()=>{document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||(e.className="hidden",n&&(clearTimeout(n),n=null))};document.addEventListener("fullscreenchange",f),document.addEventListener("webkitfullscreenchange",f),document.addEventListener("mozfullscreenchange",f),document.addEventListener("MSFullscreenChange",f);let p=0;const g=e=>{e.forEach((e=>b.observe(e)))};const w=document.querySelectorAll(".fade-in-element,.art-collection .media-wrapper,.art-collection h3,.art-collection h4");!function(e,t=66){if(!e||"function"!=typeof e)return;let n;window.addEventListener("scroll",(function(r){window.clearTimeout(n),n=setTimeout(e,t)}),!1)}((function(){p=0}));const b=new IntersectionObserver((e=>{e.forEach((e=>{if(e.isIntersecting){const t=50*p;((e,t)=>{setTimeout((()=>{e.classList.add("visible")}),t)})(e.target,t),b.unobserve(e.target),p++}}))}));function v(e){let t=1e4*Math.sin(e++);return t-Math.floor(t)}if(g(w),window.pageSettings){let A=!1,C=window.pageSettings.htmlParts;function E(){if(A)return;if(0===Object.keys(C).length)return;const e=Math.floor((new Date).getTime()/36e5),t=Object.keys(C);!function(e,t){let n,r=e.length;for(;0!==r;)n=Math.floor(v(t)*r),r--,[e[r],e[n]]=[e[n],e[r]]}(t,e);const n=t[0],r=C[n];delete C[n],A=!0,fetch(r).then((e=>e.text())).then((e=>{const t=document.getElementById("art-collection");t.insertAdjacentHTML("beforeend",e);const r=t.querySelectorAll("img:not(.loaded),video:not(.loaded)");r.forEach(((e,t)=>setupImages(e,t)));const o=t.querySelectorAll(".fade-in-element:not(.visible),.art-collection .media-wrapper:not(.visible),.art-collection h3:not(.visible),.art-collection h4:not(.visible)");g(o),s(Number(n),r),A=!1})).catch((e=>{console.error("Fetch failed:",e),A=!1}))}E();let L=0;window.addEventListener("scroll",(()=>{const e=Date.now();e-L>200&&(window.innerHeight+window.scrollY>=document.body.offsetHeight-500&&E(),L=e)}))}}));